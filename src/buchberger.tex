% LTeX: language=en
\section{Buchberger's Algorithm}
\label{sec:buchberger}

\AP While the results of \cref{sec:hilbert} show that every
\kl{ideal} of
multivariate polynomials is finitely generated, they do not provide a
constructive way to manipulate such sets. In particular, answering the
membership problem for a polynomial $p$ in the ideal generated by a finite set
$H$ of polynomials is not easy. A traditional way to do it is by using the
notion of \kl{Gröbner basis}, which is a finite set of polynomials that
generates the same ideal as $H$ and for which there is a very simple algorithm
to check membership. The simplest algorithm to compute a \kl{Gröbner basis} is
Buchberger's algorithm \cite{BUCH76}, which performs a series of saturating
steps.

\AP Instead of defining the \kl{Gröbner basis} directly, we will first define
the idea behind the membership algorithm. Let us first provide a naïve but
incomplete algorithm for membership testing: to any set $H$ of polynomials, one
can associate a rewriting system $\intro*\premulteucl{H}$ that is representing
a \intro{multiviriate Euclidian division}. A transition of the form $p
\premulteucl{H} r$ means that there exists a \kl{monomial} $\mon$ and a
constant $a \in \Field$ such that $p = a \mon q + r$ for some $q \in H$. It is
easy to see that $p \in \idlGen{H}$ if and only if $p \premulteucl{H}^* 0$. 

\AP However, due to the fact that this rewriting system is reversible, it is
not terminating and does not yield a decision procedure for the $\idlGen{H}$
membership. One way to ensure termination is to select a \kl{well-founded}
quasi-ordering $\leq$ on polynomials, and restrict the \kl(eucl){rewriting
system} to the transitions that strictly decrease in this ordering. This
defines a sub-transition system $\intro*\multeucl{H}{\leq}$ that is no longer
reversible by construction, and is furthermore \intro{terminating}: there are
no infinite sequences of reductions.

\AP The rewriting system $\multeucl{H}{\leq}$ is no longer
\intro(eucl){complete}: there might be polynomials $p$ such that $p \in
\idlGen{H}$ but $p \not\multeucl{H}{\leq}^* 0$. In this abstract
formulation, and having fixed an ordering $\leq$, a \intro{Gröbner basis} of an
\kl{ideal} $\idl$ is a finite set $G$ of polynomials such that $G$ generates
the ideal $\idl$; the rewriting system $\multeucl{G}{\leq}$ is
\kl(eucl){complete} for the ideal $\idl$.

\AP In practice, the ordering $\leq$ is usually constructed from a
\kl{well-founded} \kl{total ordering} on the \kl{monomials}, and extended to
polynomials by comparing their leading monomials (for this ordering). This
total ordering is itself obtained by a choice of an ordering on the
indeterminates $\Indets$. Because we are precisely interested in the
``orderless'' setting, we will cannot follow the classical proofs here.
Instead, we will reuse the quasi-ordering $\pmonleq$ defined in
\cref{sec:hilbert}.

\AP One particularity of the directed rewrite system is that when a polynomial
$p$ rewrites to zero, not only do we conclude that $p \in \idlGen{H}$, but also
that $p \in \idlGen{H_{\pmonleq p}}$, where $H_{\pmonleq p}$ is the set of
elements in $H$ that are less or equal to $p$.

\begin{lemma}
  \label{lem:reduction-stronger}
  Let $H$ be a finite set of polynomial
  and 
  let $p$ be a polynomial such that
  $p \multeucl{H}{\pmonleq}^* 0$.
  Then, $p \in \idlGen{H_{\pmonleq p}}$.
\end{lemma}
\begin{proof}
  We prove the result by induction on the length of the
  derivation $p \multeucl{H}{\pmonleq}^* 0$.
  The base case is trivial, because $0 \in \idlGen{\emptyset}$.
  For the inductive step, we assume that 
  $p \multeucl{H}{\pmonleq} r$ for some $r$, 
  and that $r \multeucl{H}{\pmonleq}^* 0$.
  By the inductive hypothesis, we have $r \in \idlGen{H_{\pmonleq r}}
  \subseteq \idlGen{H_{\pmonleq p}}$ since $r \pmonlt p$.
  By construction, 
  there exists a polynomial $h \in H$, a monomial $\mon$ and a constant $a \in \Field$
  such that $p = r + a \mon h$, and $r < p$.
  In particular,
  $\MaxMon(p) = \MaxMon(r + a \mon h)$ and $\MaxMon(r) \hoareDivlt \MaxMon(p)$.
  This means that $\MaxMon(a \mon h) \hoareDivleq \MaxMon(p)$,
  i.e., that $h \pmonleq p$.
  As a consequence, $p \in \idlGen{H_{\pmonleq p}}$.
\end{proof}

\AP A simple sufficient condition to ensure \kl(eucl){completeness} is the
following: for every pair of polynomials $p, q \in H$, every pair of monomials
$\mon[L], \mon[R]$, and every pair of coefficients $a, b \in \Field$, $a
\mon[L] p + b \mon[R] q$ \kl(eucl){rewrites} to $0$. We will call this property being
\intro(eucl){weakly complete}.


\begin{lemma}
    \label{lem:confl-impl-complete}
    Let $H$ be a finite set of polynomials.
    If the rewriting system $\multeucl{H}{\pmonleq}$ is \kl(eucl){weakly complete}
    then it is \kl(eucl){complete}.
\end{lemma}
\begin{proof}
    Assume towards a contradiction that
    there is a polynomial $p \in \idlGen{H}$
    that does not rewrite to $0$.
    Because $\pmonleq$ is a \kl{well-quasi-ordering},
    one can assume $p$ to be minimal for this property.

    Since $p \in \idlGen{H}$,
    there exists a sequence $\seqof{a_i}[1 \leq i \leq n]$
    of non-zero coefficients, 
    a sequence $\seqof{\mon_i}[1 \leq i \leq n]$
    of monomials,
    and a sequence 
    $\seqof{h_i}[1 \leq i \leq n]$ of elements of $H$
    such that:
    \begin{equation}
        \label{eq:confl-impl-complete:membership}
        p = \sum_{1 \leq i \leq n} a_i \mon_i h_i \quad .
    \end{equation}

    Let us write $Y$ the set of maximal monomials among all monomials
    in the polynomials $a_i \mon_i h_i$, for $1 \leq i \leq n$.
    Because $\hoareDivleq$ is a \kl{well-quasi-ordering},
    one can assume without loss of generality that
    the set $Y$ is minimal for this ordering.
    Note that $\MaxMon(p) \hoareDivleq Y$ by 
    \cref{eq:confl-impl-complete:membership}.
    There are two cases, the first one using the minimality of $p$,
    and the second one using the minimality of $Y$ and the \kl(eucl){weak completeness} of the
    rewriting system.

    \begin{description}
      \item[First case: $\MaxMon(p) \hoareDivEq Y$.]
        In this case, we have $\MaxMon(p) = Y$.
        Because $p \neq 0$, one can consider any monomial $\mon[L] \in \MaxMon(p)$.
        By definition of $Y$, there exists a $1 \leq j \leq n$
        such that $\mon[L] \in \MaxMon(a_j \mon_j h_j)$.
        Let us write $b$ the coefficient of $\mon[L]$ in $p$ 
        and $c$ the (non-zero) coefficient of $\mon[L]$ in $a_j \mon_j h_j$.
        Let us now consider the polynomial 
        $r \defined p - \frac{b}{c} a_j \mon_j h_j$,
        which is well-defined because $c \neq 0$.

        First, notice that $r \pmonleq p$. Indeed, a maximal monomial in $r$ is
        always smaller for $\divleq$ than either a monomial in $p$, or a
        monomial in $a_j \mon_j h_j$, and therefore in $\MaxMon(p)$. Second,
        notice that $\mon[L] \not\in \MaxMon(r)$, precisely
        because we substracted it. This proves that $r \pmonlt p$. As a
        consequence, we conclude that $p \multeucl{H}{\pmonleq} r$.

        Because $r$ is strictly smaller than $p$,
        we conclude that $r \multeucl{H}{\pmonleq}^* 0$.
        But this is absurd, because
        $p \multeucl{H}{\pmonleq} r \multeucl{H}{\pmonleq}^* 0$.

      \item[Second case: $\MaxMon(p) \hoareDivlt Y$.]
            In this case, there exists a monomial $\mon[L] \in Y \setminus \MaxMon(p)$.
            
            Let us write $J$ the (non-empty) set of indices $1 \leq j \leq n$ such that
            $\mon[L] \in \MaxMon(a_j \mon_j h_j)$, and define $\beta_j$ the
            (non-zero) coefficient of $\mon[L]$ in $a_j \mon_j h_j$.
            Because $\mon[L] \not\in \MaxMon(p)$, we have:
            \begin{equation}
                \label{eq:confl-impl-complete:sumzero}
                \sum_{j \in J}
                \beta_j a_j = 0 \quad .
            \end{equation}
            Because the $a_j$'s and $\beta_j$'s
            are non-zero and
            $J$ is non-empty, we conclude that $J$ contains at least two 
            elements. Let us call
            $J^1$ the set $J$ where one element has been 
            removed. To avoid nested indices, we call this
            element $\star$.

            Let us rewrite the polynomial $p$
            using the \cref{eq:confl-impl-complete:membership,eq:confl-impl-complete:sumzero},
            letting $I = \set{ 1, \dots, n}$:
            \begin{equation}
                p = \sum_{j \in J^1} a_j (\mon_j h_j - 
                \frac{\beta_j}{\beta_\star} 
                \mon_\star h_\star)
                  + 
                    \sum_{i \in I \setminus J} a_i \mon_i h_i
                  \quad .
            \end{equation}

            Now, because the rewriting system is \kl(eucl){weakly complete}, the
            polynomial $\Delta_j \defined \beta_\star \mon_j h_j - \beta_j
            \mon_\star h_\star$ rewrites to $0$, for every $j \in J^1$.
            Leveraging \cref{lem:reduction-stronger}, we conclude
            that $\Delta_j \in \idlGen{H_{\pmonleq \Delta_j}}$. In particular,
            one can express $\Delta_j$ as a combination of polynomials in $H$
            that never uses the monomial $\mon[L]$, since the coefficient of
            $\mon[L]$ in $\Delta_j$ is $\beta_j \beta_\star - \beta_\star
            \beta_j = 0$.

            We have obtained a new way to write $p$
            using elements of $H$, such that their set $Y'$
            of maximal monomials is strictly smaller than $Y$
            for $\hoareDivleq$, contradicting the 
            minimality of $Y$. \qedhere
    \end{description}
\end{proof}


\AP Thanks to \cref{lem:confl-impl-complete}, contructing a
\kl{Gröbner basis} can be reduced to extending a generating set $H$ into a
\kl(eucl){weakly complete} set. This is done by saturating the set $H$ with
respect to the possible pairs of polynomials $p, q \in H$, and is the essence
of the original Buchberger algorithm \cite{BUCH76}. In order to easily express
the saturation step, we will use the following notation: for a pair of
polynomials $p, q \in H$, we let $\CritPairs{p}{q}$ the set of pairs of
monomials $\mon[L], \mon[R]$ and pairs of field elements $(a,b)$ such that
$\Delta \defined a \mon[L] p + b \mon[R] q$ is such that $\MaxMon(\Delta)
\hoareDivlt \MaxMonMult(\mon[L] p, \mon[R] q)$, i.e., such that one of the
maximal monomials is cancelled.


\AP Because the rewriting system $\multeucl{H}{\pmonleq}$ is \kl{terminating},
and because there are finitely many possible reductions available for a given
polynomial $p$, we can associate to every polynomial $p$ a \emph{finite} set of
irreducible polynomials which we call its \intro{normal forms}
$\intro*\NormalForm[H]{p}$. Let us now give an abstract version of Buchberger's
algorithm, which is using the set $\CritPairs{p}{q}$ and \kl{normal forms}
computations to saturate the set $H$.


\begin{algorithm}
  \caption{An abstract version of Buchberger's algorithm}
  \label{alg:buchberger}
  \KwIn{A finite set $H$ of polynomials.}
  \KwOut{A \kl{Gröbner basis} of the ideal generated by $H$.}
  $G \gets H$\;
  \While{$G$ is changing}{
    $G \gets G \cup \bigcup \setof{ \NormalForm[G]{a \mon[L] p + b \mon[R] q} }{
      (p,q) \in G^2 \land
      (\mon[L], \mon[R], a, b) \in \CritPairs{p}{q}
    }$\;
  }
  return $G$\;
\end{algorithm}

\begin{lemma}
  \label{lem:buchberger-correction}
  \Cref{alg:buchberger} is correct: it returns a \kl{Gröbner basis} of the ideal
  generated by $H$.
\end{lemma}
\begin{proof}
  It is clear that if the algorithm terminates, then the set $G$ is finite, and
  generates the same ideal as $H$. Let us show that
  $G$ is \kl(eucl){weakly complete} for the rewriting system $\multeucl{G}{\pmonleq}$.
  Looking at the proof of \cref{lem:confl-impl-complete}, we see that
  we only need to check that the set $G$ is \kl(eucl){weakly complete} for the
  tuples $(p, q)$ and $(\mon[L], \mon[R], a, b) \in \CritPairs{p}{q}$.
  By construction, if the algorithm terminates, then every such pairs
  trivially rewrite to $0$.
  Thanks to \cref{lem:confl-impl-complete}, we conclude that
  $\multeucl{G}{\pmonleq}$ is \kl(eucl){complete} for the ideal generated by $H$,
  hence that $G$ is a \kl{Gröbner basis} of the ideal generated by $H$.
\end{proof}

\begin{lemma}
  \label{lem:buchberger-termination}
  \Cref{alg:buchberger} terminates.
\end{lemma}
\begin{proof}
  Let us write $\seqof{G_i}[i \in \Nat]$
  the sequence of sets $G_i$ computed by the algorithm.
  To such a set $G_i$, we associate the set 
  $\hat{G_i} \defined \upset[\pmonleq]{G_i}$.
  Because $\pmonleq$ is a \kl{well-quasi-ordering},
  there exists $n \in \Nat$ such that 
  $\hat{G_n} = \hat{G_{n+1}}$.

  Let us consider towards a contradiction that there exists
  a polynomial $p \in G_{n+1} \setminus G_n$.
  By construction, $p$ must be irreducible in $G_n$.
  However, there exists a polynomial $q \in G_n$ such that
  $p \pmoneq q$.
  In particular, there exists a constant $c \in \Field$ such that
  $r \defined p - c q \pmonlt p$,
  and therefore $p \multeucl{G_n}{\pmonleq} r$. This contradicts the fact
  that $p$ is irreducible in $G_n$.
\end{proof}

One problem with \cref{alg:buchberger} is that the set $\CritPairs{p}{q}$ is
infinite in general, but we prove in the following lemma that one can
restrict it to a finite set without loss of generality.
\begin{lemma}
  \label{lem:critpairs-finite}
  Let $p, q$ be two polynomials.
  One can compute a finite subset $C$ of $\CritPairs{p}{q}$ such that
  for every $(\mon[L], \mon[R], a, b) \in \CritPairs{p}{q}$,
  there exists a monomial $\mon$ and a non-zero constant $c \in \Field$ such that
  $(\frac{\mon[L]}{\mon}, \frac{\mon[R]}{\mon}, a / c, b / c) \in C$.
\end{lemma}
\begin{proof}
  To contruct $C$, we consider every pair of monomials $\mon[P], \mon[Q]$ 
  in $\MaxMon(p) \times \MaxMon(q)$,
  and compute their \kl{least common multiple} 
  $\lcm{\mon[P]}{\mon[Q]}$. We then 
  consider $\mon[L] = \frac{\lcm{\mon[P]}{\mon[Q]}}{\mon[P]}$ and
  $\mon[R] = \frac{\lcm{\mon[P]}{\mon[Q]}}{\mon[Q]}$.
  Finally, we let $\beta_p$ the coefficient of $\lcm{\mon[P]}{\mon[Q]}$ in $\mon[L] p$,
  and $\beta_q$ the coefficient of $\lcm{\mon[P]}{\mon[Q]}$ in $\mon[R] q$.
  We then let $C$ the set of pairs $(\mon[L], \mon[R], \beta_q, -\beta_p)$
  obtained this way.

  It is clear that $C \subseteq \CritPairs{p}{q}$, and that it is finite.
  Furthermore, if $(\mon[L], \mon[R], a, b) \in \CritPairs{p}{q}$,
  then there exists a monomial $\mon$ such that is a maximal monomial in both
  $\mon[L] p$ and $\mon[R] q$. Hence,
  $\mon[L] \mon[P] = \mon = \mon[R] \mon[Q]$ for some monomials $\mon[P], \mon[Q]$
  respectively in $\MaxMon(p)$ and $\MaxMon(q)$.
  By definition of the \kl{least common multiple}, we conclude.
\end{proof}

We have computed the \kl{Gröbner basis} of the ideal generated by
finite set $H$ of polynomials, without using any ordering on the
indeterminates themselves.
